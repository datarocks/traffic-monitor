[
    {
        "id": "94d07e407c25f282",
        "type": "tab",
        "label": "flow-radar-01",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "49e416bfab1d4055",
        "type": "tab",
        "label": "Frigate MQTT",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "90d5c925f9fbf9fd",
        "type": "tab",
        "label": "Aux data capture",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "04cc3b7b3e019683",
        "type": "group",
        "z": "94d07e407c25f282",
        "name": "TimedSpeedCounts records",
        "style": {
            "label": true
        },
        "nodes": [
            "ab1b88cd16ef31c4",
            "35c0bee67148cfa7",
            "7055d871474e5c63",
            "9496fe7a475726de",
            "617c9bb213538929",
            "c96c20a6a94d3073",
            "526eb1967dda78c4"
        ],
        "x": 54,
        "y": 999,
        "w": 1152,
        "h": 262
    },
    {
        "id": "1d00b3011a12b204",
        "type": "group",
        "z": "94d07e407c25f282",
        "name": "DetectedObjectVelocity records",
        "style": {
            "label": true
        },
        "nodes": [
            "04f7f4b860fe36bc",
            "4039fcd5e467867d",
            "4681243b9c70e906",
            "b8db51ab64a3d61e",
            "b0814f902d047f9f",
            "67f64c75edc0ef13"
        ],
        "x": 54,
        "y": 679,
        "w": 1132,
        "h": 262
    },
    {
        "id": "3acc78eb8fcb72f8",
        "type": "group",
        "z": "94d07e407c25f282",
        "name": "Raw speed records",
        "style": {
            "label": true
        },
        "nodes": [
            "c1154952a99c99a3",
            "207eac3ff9b634a5",
            "2fded2c6588bfd47",
            "1daaab9e36f6fdb2",
            "0cccf06fa248a643",
            "ab905349bef72bac",
            "18b1eaf942e6b674",
            "ffefd7af202792df",
            "65512a020a745b9a"
        ],
        "x": 54,
        "y": 1299,
        "w": 1152,
        "h": 302
    },
    {
        "id": "8dd778b3e5d3a05c",
        "type": "group",
        "z": "49e416bfab1d4055",
        "name": "listen to MQTT payloads, categorize",
        "style": {
            "label": true
        },
        "nodes": [
            "bcdcd8861df95e07",
            "67f433ccd5912ebd",
            "6cfe5662fc478c14"
        ],
        "x": 34,
        "y": 259,
        "w": 312,
        "h": 202
    },
    {
        "id": "e7337074cbb5c952",
        "type": "group",
        "z": "49e416bfab1d4055",
        "name": "query InfluxDB for Event speed readings",
        "style": {
            "label": true
        },
        "nodes": [
            "6539eff5f28950e2",
            "d541afce049d3481",
            "e63efdd922665136",
            "092f3fb8f472ef20"
        ],
        "x": 34,
        "y": 519,
        "w": 532,
        "h": 262
    },
    {
        "id": "9ee8ebd820661432",
        "type": "group",
        "z": "49e416bfab1d4055",
        "name": "create Frigate /api/subLabel request to event for speed",
        "style": {
            "label": true
        },
        "nodes": [
            "031f1f21a0ab203d",
            "0f3ff76b20f6fea0",
            "669e68daa73311d6"
        ],
        "x": 674,
        "y": 519,
        "w": 352,
        "h": 202
    },
    {
        "id": "a5d65dd0e3566daa",
        "type": "mqtt-broker",
        "name": "mqtt-broker-frigate",
        "broker": "10.10.10.223",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "73598328fc95017b",
        "type": "influxdb",
        "hostname": "127.0.0.1",
        "port": "8086",
        "protocol": "http",
        "database": "database",
        "name": "influxdb-node-red",
        "usetls": false,
        "tls": "",
        "influxdbVersion": "2.0",
        "url": "http://10.10.10.223:8086",
        "timeout": "10",
        "rejectUnauthorized": true
    },
    {
        "id": "d65c36624d553ee7",
        "type": "serial-port",
        "name": "",
        "serialport": "/dev/ttyACM0",
        "serialbaud": "19200",
        "databits": "8",
        "parity": "none",
        "stopbits": "1",
        "waitfor": "",
        "dtr": "none",
        "rts": "none",
        "cts": "none",
        "dsr": "none",
        "newline": "\\n",
        "bin": "false",
        "out": "char",
        "addchar": "",
        "responsetimeout": "5000"
    },
    {
        "id": "97157ec786fbe8be",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "e43506628b4a1cdb",
        "type": "comment",
        "z": "94d07e407c25f282",
        "name": "AN-10 API Interface",
        "info": "https://omnipresense.com/wp-content/uploads/2023/11/AN-010-Z_API_Interface.pdf",
        "x": 170,
        "y": 60,
        "wires": []
    },
    {
        "id": "490d12fc644f0914",
        "type": "inject",
        "z": "94d07e407c25f282",
        "d": true,
        "name": "init: switch to JSON, MPH, no factions",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "OJONOSF0USS2K+OUOTR>5O=1A! ",
        "payloadType": "str",
        "x": 230,
        "y": 120,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ],
        "info": "\"ON\" & \"OJ\" & \"F0\" & \"US\" & \"S2\" & \"K+\" & \"A!\"\n\n**ON** Detected Object Write\nSensor determines if an object is present by\nlooking for 2 consecutive speed reports. If\nmet, the max speed detected is reported. If a\nfaster speed is detected, additional speeds are\nreported. This lowers the number of speed\nreports for a given detected object. Use On to\nturn the mode off.\n\n**OJ** JSON Mode Write\nTurns on output to format data in JSON\nformat. An example would output:\n{\"speed\":\"0.06\"}. Use Oj to turn off JSON\nmode.\n\n**Fn** Decimal Places Write\nSet n to the number of decimal places to be\nreported. For example, setting to F2 will\nreport 2 decimal places (ex. 10.35). F0 will\nprovide the integer value only. Valid values of\nn are 0-5.\n\n**US** Miles per hour Write {\"Units\":\"mph\"} Calculations are based on the\ninternational mile (1,609.344 m per mile).\n\n**S2** 20K samples/second Write\n\n**K+** Peak Speed Average Enable Write Enables speed averaging of peak detected\nvalues across the nearest two speeds\ndetected. (-A, -C)\n\n**A!** Save Configuration Write Saves current configuration settings in flash\nmemory. Upon power loss or recycling power,\nthe saved configurations will be used as the\ndefault.\n"
    },
    {
        "id": "4907ca649aa63c1c",
        "type": "inject",
        "z": "94d07e407c25f282",
        "name": "query Module Info, after 1 sec",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "??",
        "payloadType": "str",
        "x": 210,
        "y": 160,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ],
        "info": "**??** Module Information Read\n{\"Product\":\"OPS242\"}\n{\"Version\":\"1.3.9\"}\n{\"SamplingRate\":10000, \"resolution\":0.0607}\n{“SampleSize”:1024}\n{\"Clock\":\"54\"}\n{\"Q2COUNT\":\"1149 (~22980 counts/sec)\n@t=37\"}\n{\"PowerMode\":\"Continuous\"}\n{\"Squelch\":\"100\"}\n{“RequiredMinSpeed”:”0.000”}"
    },
    {
        "id": "bb2b78040385d37e",
        "type": "json",
        "z": "94d07e407c25f282",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 670,
        "y": 280,
        "wires": [
            [
                "36b68e0861cc5fc4",
                "ab1b88cd16ef31c4",
                "04f7f4b860fe36bc",
                "c1154952a99c99a3"
            ]
        ]
    },
    {
        "id": "36b68e0861cc5fc4",
        "type": "debug",
        "z": "94d07e407c25f282",
        "name": "debug-radar-all-output",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1020,
        "y": 280,
        "wires": []
    },
    {
        "id": "16dcdaf44cc5b739",
        "type": "inject",
        "z": "94d07e407c25f282",
        "d": true,
        "name": "send Query Sampling rate",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "s?",
        "payloadType": "str",
        "x": 190,
        "y": 240,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ]
    },
    {
        "id": "87a395a01109d939",
        "type": "inject",
        "z": "94d07e407c25f282",
        "d": true,
        "name": "init: change range to not report",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "r>100",
        "payloadType": "str",
        "x": 210,
        "y": 280,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ]
    },
    {
        "id": "ab1b88cd16ef31c4",
        "type": "switch",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "if payload has key TimedSpeedCounts & count > 0",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "TimedSpeedCounts",
                "vt": "str"
            },
            {
                "t": "jsonata_exp",
                "v": "$number(msg.payload.TimedSpeedCounts.count) > 0",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 1040,
        "wires": [
            [
                "7055d871474e5c63"
            ],
            []
        ],
        "info": "TimedSpeedCounts default to 1-minute intervals\n- `count` represents number of objects at any speed\n- `average` represents the mean speed (average of units for all counts)\n- `units` represents the `average` units\n- `direction` indicates inbound/outbound relative to radar, will have both each interval"
    },
    {
        "id": "35c0bee67148cfa7",
        "type": "debug",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "debug-radar-key-valid-TimedSpeedCounts",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 1100,
        "wires": []
    },
    {
        "id": "ccd16a974b7dc6c9",
        "type": "debug",
        "z": "94d07e407c25f282",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1060,
        "y": 220,
        "wires": []
    },
    {
        "id": "5c9f0ea3d994a42c",
        "type": "inject",
        "z": "94d07e407c25f282",
        "name": "init: set unix time, after 0.2-secs",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": ".2",
        "topic": "",
        "payload": "\"C=\" & $millis()/1000",
        "payloadType": "jsonata",
        "x": 210,
        "y": 360,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ]
    },
    {
        "id": "e8e6eaf852900af0",
        "type": "inject",
        "z": "94d07e407c25f282",
        "d": true,
        "name": "get human readable timestamp, after 4 secs",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "4",
        "topic": "",
        "payload": "OH",
        "payloadType": "str",
        "x": 250,
        "y": 400,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ]
    },
    {
        "id": "9585fc99f2e09487",
        "type": "inject",
        "z": "94d07e407c25f282",
        "name": "query Output settings, after 0.1 secs",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.1",
        "topic": "",
        "payload": "O?o?",
        "payloadType": "str",
        "x": 230,
        "y": 200,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ],
        "info": "**O?/o?** Output Settings Write\nOutput current output settings for speed and\nrange. Use O? for speed settings and o? for\nrange settings."
    },
    {
        "id": "7055d871474e5c63",
        "type": "change",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "add payload.timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload.timestamp",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 1100,
        "wires": [
            [
                "35c0bee67148cfa7",
                "9496fe7a475726de"
            ]
        ]
    },
    {
        "id": "9496fe7a475726de",
        "type": "function",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "format data for influxdb TimedSpeedCounts measurement",
        "func": "msg.payload = [\n    {\n        average: Number(msg.payload.TimedSpeedCounts.average),\n        count: Number(msg.payload.TimedSpeedCounts.count),\n        time: msg.payload.timestamp\n    },\n    {\n        location: env.get(\"VAR_LOCATION\"),\n        direction: String(msg.payload.TimedSpeedCounts.direction),\n        units: String(msg.payload.TimedSpeedCounts.units)\n    }\n];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1160,
        "wires": [
            [
                "617c9bb213538929"
            ]
        ]
    },
    {
        "id": "c96c20a6a94d3073",
        "type": "catch",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "catch influxdb writes TimedSpeedCounts",
        "scope": [
            "617c9bb213538929"
        ],
        "uncaught": false,
        "x": 980,
        "y": 1160,
        "wires": [
            [
                "16550239673f6d6d"
            ]
        ]
    },
    {
        "id": "16550239673f6d6d",
        "type": "debug",
        "z": "94d07e407c25f282",
        "name": "debug influxdb write errors",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "error",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1560,
        "y": 1140,
        "wires": []
    },
    {
        "id": "a9d702a51bc8f0c9",
        "type": "comment",
        "z": "94d07e407c25f282",
        "name": "variables to pass",
        "info": "Via Docker Environment \n- `device_ip` of Pi (for influxDB server)\n- `location` string (for influxDB `location` tag)\n- `radar_camera` name of camera (for attaching speeds to events) - needs to match Frigate config\n\n\n",
        "x": 360,
        "y": 60,
        "wires": []
    },
    {
        "id": "526eb1967dda78c4",
        "type": "comment",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "name": "TimedSpeedCounts are @O and @|300 (5-min)",
        "info": "",
        "x": 1000,
        "y": 1040,
        "wires": []
    },
    {
        "id": "04f7f4b860fe36bc",
        "type": "switch",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "name": "if payload has key DetectedObjectVelocity",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "DetectedObjectVelocity",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 240,
        "y": 720,
        "wires": [
            [
                "4039fcd5e467867d"
            ]
        ]
    },
    {
        "id": "4039fcd5e467867d",
        "type": "change",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "name": "add payload.timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload.timestamp",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 780,
        "wires": [
            [
                "4681243b9c70e906",
                "67f64c75edc0ef13"
            ]
        ]
    },
    {
        "id": "4681243b9c70e906",
        "type": "function",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "name": "format data for influxdb DetectedObjectVelocity measurement",
        "func": "msg.payload = [\n    {\n        velocity: Number(msg.payload.DetectedObjectVelocity),\n        time: msg.payload.timestamp\n    },\n    {\n        location: env.get(\"VAR_LOCATION\"),\n        direction: String(msg.payload.direction),\n        units: String(msg.payload.unit)\n    }\n];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 840,
        "wires": [
            [
                "b8db51ab64a3d61e"
            ]
        ]
    },
    {
        "id": "b0814f902d047f9f",
        "type": "catch",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "name": "catch influxdb writes DetectedObjectVelocity",
        "scope": [
            "b8db51ab64a3d61e"
        ],
        "uncaught": false,
        "x": 990,
        "y": 900,
        "wires": [
            [
                "16550239673f6d6d"
            ]
        ]
    },
    {
        "id": "affe7cfb9861e62d",
        "type": "serial in",
        "z": "94d07e407c25f282",
        "name": "receive OPS243 serial (USB - /dev/ttyACM0)",
        "serial": "d65c36624d553ee7",
        "x": 730,
        "y": 220,
        "wires": [
            [
                "bb2b78040385d37e",
                "ccd16a974b7dc6c9"
            ]
        ]
    },
    {
        "id": "8e8ede8ca221552b",
        "type": "serial out",
        "z": "94d07e407c25f282",
        "name": "send to OPS243 serial (USB)",
        "serial": "d65c36624d553ee7",
        "x": 680,
        "y": 120,
        "wires": []
    },
    {
        "id": "617c9bb213538929",
        "type": "influxdb out",
        "z": "94d07e407c25f282",
        "g": "04cc3b7b3e019683",
        "influxdb": "73598328fc95017b",
        "name": "write influxdb TimedSpeedCounts",
        "measurement": "TimedSpeedCounts",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "taffic_monitor_01",
        "bucket": "tm-05",
        "x": 620,
        "y": 1220,
        "wires": []
    },
    {
        "id": "b8db51ab64a3d61e",
        "type": "influxdb out",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "influxdb": "73598328fc95017b",
        "name": "write influxdb DetectedObjectVelocity",
        "measurement": "DetectedObjectVelocity",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "taffic_monitor_01",
        "bucket": "tm-05",
        "x": 610,
        "y": 900,
        "wires": []
    },
    {
        "id": "3e1c5c9ee55e3284",
        "type": "inject",
        "z": "94d07e407c25f282",
        "name": "init: reset range report",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "r>0r<0A!",
        "payloadType": "str",
        "x": 180,
        "y": 320,
        "wires": [
            [
                "8e8ede8ca221552b"
            ]
        ]
    },
    {
        "id": "c1154952a99c99a3",
        "type": "switch",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "if payload has key speed",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "speed",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 190,
        "y": 1340,
        "wires": [
            [
                "2fded2c6588bfd47"
            ]
        ],
        "info": "TimedSpeedCounts default to 1-minute intervals\n- `count` represents number of objects at any speed\n- `average` represents the mean speed (average of units for all counts)\n- `units` represents the `average` units\n- `direction` indicates inbound/outbound relative to radar, will have both each interval"
    },
    {
        "id": "207eac3ff9b634a5",
        "type": "debug",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "debug-radar-key-valid-raw-speeds",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 1340,
        "wires": []
    },
    {
        "id": "2fded2c6588bfd47",
        "type": "change",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "add payload.timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload.timestamp",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 1400,
        "wires": [
            [
                "207eac3ff9b634a5",
                "18b1eaf942e6b674"
            ]
        ]
    },
    {
        "id": "1daaab9e36f6fdb2",
        "type": "influxdb out",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "influxdb": "73598328fc95017b",
        "name": "write influxdb RawSpeedMagnitude",
        "measurement": "RawSpeedMagnitude",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "taffic_monitor_01",
        "bucket": "tm-05",
        "x": 980,
        "y": 1540,
        "wires": []
    },
    {
        "id": "0cccf06fa248a643",
        "type": "catch",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "catch influxdb writes RawSpeedMagnitude",
        "scope": [
            "1daaab9e36f6fdb2"
        ],
        "uncaught": false,
        "x": 1020,
        "y": 1460,
        "wires": [
            [
                "16550239673f6d6d"
            ]
        ]
    },
    {
        "id": "ab905349bef72bac",
        "type": "function",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "format data for influxdb speed, magnitude measurement, inbound",
        "func": "msg.payload = [\n    {\n        speed: Number(msg.payload.speed),\n        magnitude: Number(msg.payload.magnitude),\n        time: msg.payload.timestamp\n    },\n    {\n        location: env.get(\"VAR_LOCATION\"),\n        direction: String(\"inbound\"),\n        units: String(msg.payload.unit)\n    }\n];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1520,
        "wires": [
            [
                "1daaab9e36f6fdb2",
                "65512a020a745b9a"
            ]
        ]
    },
    {
        "id": "18b1eaf942e6b674",
        "type": "switch",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "switch inbound, outbound speed",
        "property": "payload.speed",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "lt",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 1460,
        "wires": [
            [
                "ab905349bef72bac"
            ],
            [
                "ffefd7af202792df"
            ]
        ]
    },
    {
        "id": "ffefd7af202792df",
        "type": "function",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "format data for influxdb speed, magnitude measurement, outbound",
        "func": "msg.payload = [\n    {\n        speed: Number(msg.payload.speed),\n        magnitude: Number(msg.payload.magnitude),\n        time: msg.payload.timestamp\n    },\n    {\n        location: env.get(\"VAR_LOCATION\"),\n        direction: String(\"outbound\"),\n        units: String(msg.payload.unit)\n    }\n];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 1560,
        "wires": [
            [
                "1daaab9e36f6fdb2",
                "65512a020a745b9a"
            ]
        ]
    },
    {
        "id": "65512a020a745b9a",
        "type": "debug",
        "z": "94d07e407c25f282",
        "g": "3acc78eb8fcb72f8",
        "name": "debug-radar-raws-speeds-write",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 1400,
        "wires": []
    },
    {
        "id": "67f64c75edc0ef13",
        "type": "debug",
        "z": "94d07e407c25f282",
        "g": "1d00b3011a12b204",
        "name": "debug-radar-DetectObjectVelocity",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 780,
        "wires": []
    },
    {
        "id": "6c2d22f0a8cb1fc1",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug: Broker status events",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 340,
        "y": 40,
        "wires": []
    },
    {
        "id": "fd148029fe6bee47",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug: broker publish events",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 340,
        "y": 80,
        "wires": []
    },
    {
        "id": "038275ccb8bafbb0",
        "type": "mqtt in",
        "z": "49e416bfab1d4055",
        "name": "",
        "topic": "frigate/events",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "a5d65dd0e3566daa",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 90,
        "y": 180,
        "wires": [
            [
                "4a1c5b87abde2112",
                "bcdcd8861df95e07"
            ]
        ]
    },
    {
        "id": "4a1c5b87abde2112",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug: published frigate messages",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 360,
        "y": 160,
        "wires": []
    },
    {
        "id": "1720d60a87cfb2d7",
        "type": "aedes broker",
        "z": "49e416bfab1d4055",
        "name": "frigate-local",
        "mqtt_port": "1883",
        "mqtt_ws_bind": "port",
        "mqtt_ws_port": "",
        "mqtt_ws_path": "",
        "cert": "",
        "key": "",
        "certname": "",
        "keyname": "",
        "persistence_bind": "memory",
        "dburl": "",
        "usetls": false,
        "x": 90,
        "y": 60,
        "wires": [
            [
                "6c2d22f0a8cb1fc1"
            ],
            [
                "fd148029fe6bee47"
            ]
        ]
    },
    {
        "id": "bcdcd8861df95e07",
        "type": "switch",
        "z": "49e416bfab1d4055",
        "g": "8dd778b3e5d3a05c",
        "name": "payload.type == \"end\"",
        "property": "payload.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "end",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 160,
        "y": 300,
        "wires": [
            [
                "67f433ccd5912ebd"
            ]
        ]
    },
    {
        "id": "67f433ccd5912ebd",
        "type": "switch",
        "z": "49e416bfab1d4055",
        "g": "8dd778b3e5d3a05c",
        "name": "after label is car or bike",
        "property": "payload.after.label",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "car",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "bicycle",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 210,
        "y": 360,
        "wires": [
            [
                "6cfe5662fc478c14"
            ],
            [
                "6cfe5662fc478c14"
            ]
        ]
    },
    {
        "id": "6cfe5662fc478c14",
        "type": "function",
        "z": "49e416bfab1d4055",
        "g": "8dd778b3e5d3a05c",
        "name": "calculate direction",
        "func": "var $myZoneNearIndex = msg.payload.after.entered_zones.indexOf(\"zone_near\");\nvar $myZoneFarIndex = msg.payload.after.entered_zones.indexOf(\"zone_far\");\n\nvar $myDirection = ($myZoneNearIndex >= 0 && $myZoneNearIndex >= 0) ? ($myZoneFarIndex < $myZoneNearIndex ? \"inbound\" : \"outbound\") : undefined;\n\nmsg.payload.after.nr_direction = $myDirection;\n\nmsg.topic = \"event_end_car_bike\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 420,
        "wires": [
            [
                "9f1012eacf4d076f",
                "6539eff5f28950e2"
            ]
        ]
    },
    {
        "id": "9f1012eacf4d076f",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug: calc direction",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 280,
        "wires": []
    },
    {
        "id": "6539eff5f28950e2",
        "type": "function",
        "z": "49e416bfab1d4055",
        "g": "e7337074cbb5c952",
        "name": "create influxdb query based on msg, +/- 2 sec, return median",
        "func": "var query = \"\";\n// query += \"from(bucket: \" + env.get(\"VAR_INFLUXDB_BUCKET\") + \")\"\nquery += \"from(bucket: \\\"tm-05\\\")\\n\";\nquery += \"    |> range(start: \" + (Math.floor(msg.payload.after.start_time)-2) +\", stop: \" + (Math.ceil(msg.payload.after.end_time)+2) + \")\\n\";\nquery += \"    |> filter(fn: (r) => r[\\\"_measurement\\\"] == \\\"DetectedObjectVelocity\\\")\\n\";\nquery += \"    |> filter(fn: (r) => r[\\\"_field\\\"] == \\\"velocity\\\")\\n\";\nquery += \"    |> filter(fn: (r) => r[\\\"direction\\\"] == \\\"\" + msg.payload.after.nr_direction + \"\\\")\\n\";\nquery += \"    |> filter(fn: (r) => r[\\\"location\\\"] == \\\"\" + env.get(\"VAR_LOCATION\") + \"\\\")\\n\";\nquery += \"    |> filter(fn: (r) => r[\\\"units\\\"] == \\\"mph\\\")\\n\";\nquery += \"    |> median(column: \\\"_value\\\")\\n\"; \n\nmsg.query = query;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 560,
        "wires": [
            [
                "6f8144816d69687d",
                "d541afce049d3481",
                "0f3ff76b20f6fea0"
            ]
        ]
    },
    {
        "id": "6f8144816d69687d",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug-influxdb-query-string-01",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "query",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 790,
        "y": 340,
        "wires": []
    },
    {
        "id": "8bfe9073f29ff037",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug - influxdb return delay 0-sec",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 740,
        "wires": []
    },
    {
        "id": "d541afce049d3481",
        "type": "influxdb in",
        "z": "49e416bfab1d4055",
        "g": "e7337074cbb5c952",
        "influxdb": "73598328fc95017b",
        "name": "query event end DetectedObjectVelocity range",
        "query": "",
        "rawOutput": false,
        "precision": "",
        "retentionPolicy": "",
        "org": "taffic_monitor_01",
        "x": 300,
        "y": 620,
        "wires": [
            [
                "092f3fb8f472ef20",
                "882bc1f194714da1"
            ]
        ]
    },
    {
        "id": "031f1f21a0ab203d",
        "type": "http request",
        "z": "49e416bfab1d4055",
        "g": "9ee8ebd820661432",
        "name": "add subLabel to event",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://{{{frigate_ip}}}:5000/api/events/{{{event_id}}}/sub_label",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 900,
        "y": 680,
        "wires": [
            [
                "50574c0e9f62cf10"
            ]
        ]
    },
    {
        "id": "0f3ff76b20f6fea0",
        "type": "join",
        "z": "49e416bfab1d4055",
        "g": "9ee8ebd820661432",
        "name": "join message objects",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 800,
        "y": 560,
        "wires": [
            [
                "8a665815ec136e90",
                "669e68daa73311d6"
            ]
        ]
    },
    {
        "id": "8a665815ec136e90",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "debug event car bike speed",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1280,
        "y": 560,
        "wires": []
    },
    {
        "id": "e63efdd922665136",
        "type": "function",
        "z": "49e416bfab1d4055",
        "g": "e7337074cbb5c952",
        "name": "query, add topic",
        "func": "msg.topic = \"query_return\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 740,
        "wires": [
            [
                "0f3ff76b20f6fea0",
                "8bfe9073f29ff037"
            ]
        ]
    },
    {
        "id": "669e68daa73311d6",
        "type": "function",
        "z": "49e416bfab1d4055",
        "g": "9ee8ebd820661432",
        "name": "create subLabel message",
        "func": "var newMsg = {};\n\nnewMsg.event_id = msg.payload.event_end_car_bike.after.id;\nnewMsg.frigate_ip = env.get(\"VAR_DEVICE_IP\");\n\nnewMsg.payload = {\n    \"subLabel\": String(\"speed_\" + msg.payload.query_return[0].units + \"_\" + msg.payload.query_return[0].direction), \n    \"subLabelScore\": (Math.abs(msg.payload.query_return[0]._value)/1000)\n    };\n\nreturn newMsg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 620,
        "wires": [
            [
                "1b0344bd4829de6b",
                "031f1f21a0ab203d"
            ]
        ]
    },
    {
        "id": "1b0344bd4829de6b",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "subLabel complete message to send",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 620,
        "wires": []
    },
    {
        "id": "092f3fb8f472ef20",
        "type": "switch",
        "z": "49e416bfab1d4055",
        "g": "e7337074cbb5c952",
        "name": "pass valid query returns",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 680,
        "wires": [
            [
                "e63efdd922665136"
            ]
        ]
    },
    {
        "id": "882bc1f194714da1",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "influxdb query return",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 760,
        "y": 400,
        "wires": []
    },
    {
        "id": "50574c0e9f62cf10",
        "type": "debug",
        "z": "49e416bfab1d4055",
        "name": "frigate return, event speed sub_label",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 680,
        "wires": []
    },
    {
        "id": "8cee82669b6b8512",
        "type": "comment",
        "z": "90d5c925f9fbf9fd",
        "name": "capture bluetooth to influxdb",
        "info": "",
        "x": 220,
        "y": 140,
        "wires": []
    }
]